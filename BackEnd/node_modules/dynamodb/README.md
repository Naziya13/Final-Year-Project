
`dynamodb` is a [DynamoDB][5] data mapper for [node.js][1].

## Features
* Simplified data modeling and mapping to DynamoDB types
* Advanced chainable apis for [query](#query) and [scan](#scan) operations
* Data validation
* [Autogenerating UUIDs](#uuid)
* [Global Secondary Indexes](#global-indexes)
* [Local Secondary Indexes](#local-secondary-indexes)
* [Parallel Scans](#parallel-scan)

## Installation

    npm install dynamodb

## Getting Started
First, you need to configure the [AWS SDK][2] with your credentials.

```js
var dynamo = require('dynamodb');
dynamo.AWS.config.loadFromPath('credentials.json');
```

When running on EC2 its recommended to leverage EC2 IAM roles. If you have configured your instance to use IAM roles, DynamoDB will automatically select these credentials for use in your application, and you do not need to manually provide credentials in any other format.

```js
var dynamo = require('dynamodb');
dynamo.AWS.config.update({region: "REGION"}); // region must be set
```

You can also directly pass in your access key id, secret and region.
  * Its recommend you not hard-code credentials inside an application. Use this method only for small personal scripts or for testing purposes.

```js
var dynamo = require('dynamodb');
dynamo.AWS.config.update({accessKeyId: 'AKID', secretAccessKey: 'SECRET', region: "REGION"});
```

Currently the following region codes are available in Amazon:

|      Code      |           Name           |
| -------------- | ------------------------ |
| ap-northeast-1 | Asia Pacific (Tokyo)     |
| ap-southeast-1 | Asia Pacific (Singapore) |
| ap-southeast-2 | Asia Pacific (Sydney)    |
| eu-central-1   | EU (Frankfurt)           |
| eu-west-1      | EU (Ireland)             |
| sa-east-1      | South America (Sao Paulo)|
| us-east-1      | US East (N. Virginia)    |
| us-west-1      | US West (N. California)  |
| us-west-2      | US West (Oregon)         |

### Define a Model
Models are defined through the toplevel define method.

```js
var Account = dynamo.define('Account', {
  hashKey : 'email',

  // add the timestamp attributes (updatedAt, createdAt)
  timestamps : true,

  schema : {
    email   : Joi.string().email(),
    name    : Joi.string(),
    age     : Joi.number(),
    roles   : dynamo.types.stringSet(),
    settings : {
      nickname      : Joi.string(),
      acceptedTerms : Joi.boolean().default(false)
    }
  }
});
```

Models can also be defined with hash and range keys.

```js
var BlogPost = dynamo.define('BlogPost', {
  hashKey : 'email',
  rangeKey : ‘title’,
  schema : {
    email   : Joi.string().email(),
    title   : Joi.string(),
    content : Joi.binary(),
    tags   : dynamo.types.stringSet(),
  }
});
```

### Create Tables for all defined modules

```js
dynamo.createTables(function(err) {
  if (err) {
    console.log('Error creating tables: ', err);
  } else {
    console.log('Tables has been created');
  }
});
```

When creating tables you can pass specific throughput settings for any defined models.

```js
dynamo.createTables({
  'BlogPost': {readCapacity: 5, writeCapacity: 10},
  'Account': {readCapacity: 20, writeCapacity: 4}
}, function(err) {
  if (err) {
    console.log('Error creating tables: ', err);
  } else {
    console.log('Tables has been created');
  }
});
```

### Delete Table

```js
BlogPost.deleteTable(function(err) {
  if (err) {
    console.log('Error deleting table: ', err);
  } else {
    console.log('Table has been deleted');
  }
});
```

### Schema Types
DynamoDB provides the following schema types:

* String
* Number
* StringSet
* NumberSet
* Boolean
* Date
* UUID
* TimeUUID

#### UUID
UUIDs can be declared for any attributes, including hash and range keys. By
Default, the uuid will be automatically generated when attempting to create
the model in DynamoDB.

```js
var Tweet = dynamo.define('Tweet', {
  hashKey : 'TweetID',
  timestamps : true,
  schema : {
    TweetID : dynamo.types.uuid(),
    content : Joi.string(),
  }
});
```

### Configuration
You can configure dynamo to automatically add `createdAt` and `updatedAt` timestamp attributes when
saving and updating a model. `updatedAt` will only be set when updating a record and will not be set on initial creation of the model.

```js
var Account = dynamo.define('Account', {
  hashKey : 'email',

  // add the timestamp attributes (updatedAt, createdAt)
  timestamps : true,

  schema : {
    email : Joi.string().email(),
  }
});
```

If you want dynamo to handle timestamps, but only want some of them, or want your
timestamps to be called something else, you can override each attribute individually:

```js
var Account = dynamo.define('Account', {
  hashKey : 'email',

  // enable timestamps support
  timestamps : true,

  // I don't want createdAt
  createdAt: false,

  // I want updatedAt to actually be called updateTimestamp
  updatedAt: 'updateTimestamp'

  schema : {
    email : Joi.string().email(),
  }
});
```

You can override the table name the model will use.

```js
var Event = dynamo.define('Event', {
  hashKey : 'name',
  schema : {
    name : Joi.string(),
    total : Joi.number()
  },

  tableName: 'deviceEvents'
});
```

if you set the tableName to a function, dynamo will use the result of the function as the active table to use.
Useful for storing time series 